{"ast":null,"code":"import React,{useState}from'react';import{useIsAuthenticated,useMsal}from'@azure/msal-react';import{loginRequest}from'../auth/authConfig';import{Button}from'./ui/button';import{LogIn,LogOut}from'lucide-react';import{useCurrentUser,getUserInfo}from'../auth/AuthProvider';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const LoginButton=()=>{const{instance,accounts}=useMsal();const isAuthenticated=useIsAuthenticated();const currentUser=useCurrentUser();const userInfo=getUserInfo(currentUser);const[isLoggingIn,setIsLoggingIn]=useState(false);const[error,setError]=useState(null);const handleLogin=async()=>{try{setIsLoggingIn(true);setError(null);console.log(\"Starting login process...\");// Instead of clearCache (which doesn't exist), just logout before login\n// This can help with authentication loops\nif(accounts.length>0){// Remove all accounts from the cache\naccounts.forEach(account=>{instance.logoutRedirect({account,postLogoutRedirectUri:window.location.origin}).catch(e=>console.error(\"Logout during login failed:\",e));return;// Just remove the first account\n});}else{await instance.loginRedirect(loginRequest);}}catch(error){console.error(\"Login failed:\",error);setError(\"Login failed. Please try again.\");}finally{setIsLoggingIn(false);}};const handleLogout=async()=>{try{console.log(\"Starting logout process...\");await instance.logoutRedirect();}catch(error){console.error(\"Logout failed:\",error);}};// If there's an error, show it\nif(error){return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500 mr-2\",children:error}),/*#__PURE__*/_jsx(Button,{onClick:()=>setError(null),variant:\"outline\",children:\"Dismiss\"})]});}if(isAuthenticated&&userInfo){return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mr-4 text-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-slate-700\",children:userInfo.name}),/*#__PURE__*/_jsx(\"div\",{className:\"text-slate-500 text-xs\",children:userInfo.email})]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",onClick:handleLogout,className:\"flex items-center\",disabled:isLoggingIn,children:[/*#__PURE__*/_jsx(LogOut,{className:\"h-4 w-4 mr-2\"}),\"Sign Out\"]})]});}return/*#__PURE__*/_jsxs(Button,{onClick:handleLogin,className:\"flex items-center bg-blue-600 hover:bg-blue-700\",disabled:isLoggingIn,children:[/*#__PURE__*/_jsx(LogIn,{className:\"h-4 w-4 mr-2\"}),isLoggingIn?\"Signing in...\":\"Sign in with Microsoft\"]});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}